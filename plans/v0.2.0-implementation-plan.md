# Weft v0.2.0 Implementation Plan

**Date**: 2025-12-22
**Version**: 0.1.9 ‚Üí 0.2.0
**Release Type**: Minor (Non-Breaking)
**Target Compliance**: 92/100 Anthropic Score

---

## Executive Summary

Weft v0.2.0 addresses critical gaps in the REST API identified through Anthropic best practices analysis. All changes are **backward compatible** (additive only), making this a safe minor version bump.

**Key Improvements**:
- ‚úÖ Pagination for scalability (supports >100 agents/work items)
- ‚úÖ Semantic context for better agent decision-making
- ‚úÖ OpenAPI documentation for discoverability
- ‚úÖ Parameter naming consistency
- ‚úÖ Batch operations for fleet management

**Estimated Effort**: 16-22 hours total
**Parallelization**: 3 batches, up to 5 agents in parallel per batch
**Expected Time Reduction**: ~75% vs sequential (5-7 days ‚Üí 1.5-2 days)

---

## Complexity Assessment

| Aspect | Details |
|--------|---------|
| **Systems Affected** | 5 (API routes, shared types, service layer, tests, docs) |
| **Classification** | Moderate (3-5 systems) |
| **Breaking Changes** | None - all additive |
| **Test Coverage** | Maintain 127 passing tests, add ~40 new tests |
| **Dependencies** | Warp 0.4.0 pagination pattern (reference) |

---

## Batch Execution Plan

### Batch 1: Foundation (5 phases - ALL PARALLEL)

**Goal**: Establish core infrastructure needed by all features

| Phase | Goal | Effort | Depends On |
|-------|------|--------|------------|
| 1.1 | Create pagination utilities module | M | None |
| 1.2 | Add pagination types to @loominal/shared | S | None |
| 1.3 | Add semantic context types to @loominal/shared | S | None |
| 1.4 | Standardize parameter naming (support both) | S | None |
| 1.5 | Add batch operation types to @loominal/shared | S | None |

**Parallelization**: All 5 phases independent ‚Üí 5 agents in parallel
**Expected Time**: 2-3 hours (vs 6-8 sequential)

---

### Batch 2: Core Features (6 phases - PARALLEL)

**Goal**: Implement pagination, semantic context, and batch operations

| Phase | Goal | Effort | Depends On |
|-------|------|--------|------------|
| 2.1 | Add pagination to /api/agents endpoint | M | 1.1, 1.2, 1.4 |
| 2.2 | Add pagination to /api/work endpoint | M | 1.1, 1.2, 1.4 |
| 2.3 | Add pagination to /api/targets endpoint | M | 1.1, 1.2, 1.4 |
| 2.4 | Add semantic context to work items | M | 1.3 |
| 2.5 | Add semantic context to targets | M | 1.3 |
| 2.6 | Implement batch operation endpoints | M | 1.5 |

**Parallelization**: All 6 phases independent after Batch 1 ‚Üí 6 agents in parallel
**Expected Time**: 3-4 hours (vs 12-16 sequential)

---

### Batch 3: Documentation & Validation (3 phases - SEQUENTIAL)

**Goal**: Document finalized API and add validation

| Phase | Goal | Effort | Depends On |
|-------|------|--------|------------|
| 3.1 | Create OpenAPI 3.0 specification | M | All Batch 2 |
| 3.2 | Add Swagger UI endpoint (/api/docs) | S | 3.1 |
| 3.3 | Add runtime OpenAPI validation | M | 3.1 |

**Parallelization**: 3.1 must complete first, then 3.2 and 3.3 in parallel
**Expected Time**: 6-8 hours (vs 8-10 sequential)

---

## Detailed Phase Specifications

### Phase 1.1: Create Pagination Utilities Module ‚öôÔ∏è

**Status**: ‚ö™ Not Started
**Effort**: M (3-4 hours)
**Depends On**: None

**Tasks**:
- [ ] Copy `/var/home/mike/source/loominal/warp/src/pagination.ts` to `weft/weft/src/utils/pagination.ts`
- [ ] Adapt for Express REST API (vs MCP tool args)
- [ ] Add `parsePaginationQuery()` function for Express `req.query`
- [ ] Add unit tests (`pagination.test.ts`)
- [ ] Verify all helper functions work with REST context

**Files Affected**:
- `weft/src/utils/pagination.ts` (new)
- `weft/src/utils/__tests__/pagination.test.ts` (new)

**Done When**:
- ‚úÖ All Warp pagination utilities ported
- ‚úÖ Express-specific helpers added
- ‚úÖ 15+ unit tests passing
- ‚úÖ Type-safe with no `any` types

**Reference**: `/var/home/mike/source/loominal/warp/src/pagination.ts`

---

### Phase 1.2: Add Pagination Types to @loominal/shared üì¶

**Status**: ‚ö™ Not Started
**Effort**: S (30 min)
**Depends On**: None

**Tasks**:
- [ ] Add `PaginationState` interface to `shared/src/types.ts`
- [ ] Add `PaginationMetadata` interface
- [ ] Add `PaginationCursor` type alias
- [ ] Export from `shared/src/index.ts`
- [ ] Build shared package

**Files Affected**:
- `shared/src/types.ts` (edit)
- `shared/src/index.ts` (edit)

**Done When**:
- ‚úÖ Types exported from `@loominal/shared`
- ‚úÖ Build passes (`pnpm build`)
- ‚úÖ Types available in weft package

**Type Definitions**:
```typescript
export type PaginationCursor = string;

export interface PaginationState {
  offset: number;
  limit: number;
  filterHash?: string;
}

export interface PaginationMetadata {
  count: number;
  total?: number;
  nextCursor: PaginationCursor | null;
  prevCursor: PaginationCursor | null;
  hasMore: boolean;
}
```

---

### Phase 1.3: Add Semantic Context Types to @loominal/shared üîç

**Status**: ‚ö™ Not Started
**Effort**: S (30 min)
**Depends On**: None

**Tasks**:
- [ ] Add `AgentSummary` interface (minimal agent info for embedding)
- [ ] Add `WorkItemResponse` interface with `assignedToAgent` field
- [ ] Add `TargetResponse` interface with `lastSpinUp.agent` field
- [ ] Add `ChannelMessageResponse` interface with `senderAgent` field
- [ ] Export from `shared/src/index.ts`

**Files Affected**:
- `shared/src/types.ts` (edit)
- `shared/src/index.ts` (edit)

**Done When**:
- ‚úÖ All semantic context types defined
- ‚úÖ Backward compatible (extends existing types)
- ‚úÖ Build passes

**Type Definitions**:
```typescript
export interface AgentSummary {
  guid: string;
  handle?: string;
  agentType: 'claude-code' | 'copilot-cli';
  hostname?: string;
}

export interface WorkItemResponse extends WorkItem {
  assignedToAgent?: AgentSummary; // Resolved agent details
}

export interface TargetResponse extends Target {
  lastSpinUp?: {
    time: string;
    agent?: AgentSummary;
    workItemId?: string;
    outcome: 'success' | 'failure';
  };
}

export interface ChannelMessageResponse {
  sender: string; // Original GUID
  senderAgent?: AgentSummary; // Resolved details
  content: string;
  timestamp: string;
}
```

---

### Phase 1.4: Standardize Parameter Naming (Support Both) üè∑Ô∏è

**Status**: ‚ö™ Not Started
**Effort**: S (1 hour)
**Depends On**: None

**Tasks**:
- [ ] Update `/api/work` GET route to accept `boundary` OR `classification`
- [ ] Update `/api/targets` GET route to accept `boundary` OR `classification`
- [ ] Add deprecation header when old param used: `X-Deprecated-Param: classification`
- [ ] Update parameter parsing to prefer `boundary`
- [ ] Add tests for both parameter names

**Files Affected**:
- `weft/src/api/routes/work.ts` (edit)
- `weft/src/api/routes/targets.ts` (edit)
- `weft/src/api/__tests__/work.test.ts` (edit)
- `weft/src/api/__tests__/targets.test.ts` (edit)

**Done When**:
- ‚úÖ Both `?boundary=X` and `?classification=X` work
- ‚úÖ Deprecation header added for `classification`
- ‚úÖ Tests verify both parameters
- ‚úÖ No breaking changes

**Implementation Example**:
```typescript
// In work.ts and targets.ts
const { status, boundary, classification } = req.query;

const filter: { status?: string; boundary?: string } = {};

// Prefer 'boundary', fall back to 'classification'
const boundaryValue = (boundary || classification) as string | undefined;
if (boundaryValue) {
  filter.boundary = boundaryValue;

  // Add deprecation header if old param used
  if (classification && !boundary) {
    res.setHeader('X-Deprecated-Param', 'classification (use boundary instead)');
  }
}
```

---

### Phase 1.5: Add Batch Operation Types to @loominal/shared üìã

**Status**: ‚ö™ Not Started
**Effort**: S (30 min)
**Depends On**: None

**Tasks**:
- [ ] Add `BatchShutdownRequest` interface
- [ ] Add `BatchShutdownResponse` interface
- [ ] Add `BatchDisableTargetsRequest` interface
- [ ] Add `BatchCancelWorkRequest` interface
- [ ] Add generic `BatchOperationResponse` interface
- [ ] Export from `shared/src/index.ts`

**Files Affected**:
- `shared/src/types.ts` (edit)
- `shared/src/index.ts` (edit)

**Done When**:
- ‚úÖ All batch operation types defined
- ‚úÖ Types support filter-based selection
- ‚úÖ Responses include success/failure details
- ‚úÖ Build passes

**Type Definitions**:
```typescript
export interface BatchShutdownRequest {
  filter?: {
    status?: string;
    idleTimeMs?: number;
    agentType?: string;
  };
  agentGuids?: string[]; // Alternative to filter
  graceful?: boolean;
}

export interface BatchOperationResponse {
  success: string[]; // GUIDs of successful operations
  failed: string[];  // GUIDs of failed operations
  count: number;     // Total successful
  errors: Record<string, string>; // GUID ‚Üí error message
}
```

---

### Phase 2.1: Add Pagination to /api/agents Endpoint üìä

**Status**: ‚ö™ Not Started
**Effort**: M (2-3 hours)
**Depends On**: Phase 1.1, 1.2, 1.4

**Tasks**:
- [ ] Import pagination utilities in `agents.ts`
- [ ] Parse `cursor` and `limit` query params using `parsePaginationQuery()`
- [ ] Update `service.listAgents()` to accept pagination options
- [ ] Add offset/limit logic to coordinator service
- [ ] Return `PaginationMetadata` in response
- [ ] Add unit tests for paginated responses
- [ ] Test cursor validation and filter consistency

**Files Affected**:
- `weft/src/api/routes/agents.ts` (edit)
- `weft/src/coordinator/index.ts` (edit - add pagination params)
- `weft/src/api/__tests__/agents.test.ts` (edit)

**Done When**:
- ‚úÖ `GET /api/agents?limit=50` returns first 50 agents
- ‚úÖ `GET /api/agents?cursor=xyz` continues from cursor
- ‚úÖ Response includes `{ agents, count, total, hasMore, nextCursor, prevCursor }`
- ‚úÖ Backward compatible (no cursor = returns first page)
- ‚úÖ Tests verify pagination logic
- ‚úÖ Default limit: 50, max limit: 100

**Response Format**:
```json
{
  "agents": [...],
  "count": 50,
  "total": 847,
  "hasMore": true,
  "nextCursor": "eyJvZmZzZXQiOjUwLCJsaW1pdCI6NTB9",
  "prevCursor": null
}
```

---

### Phase 2.2: Add Pagination to /api/work Endpoint üìä

**Status**: ‚ö™ Not Started
**Effort**: M (2-3 hours)
**Depends On**: Phase 1.1, 1.2, 1.4

**Tasks**:
- [ ] Import pagination utilities in `work.ts`
- [ ] Parse `cursor` and `limit` query params
- [ ] Update `service.listWork()` to accept pagination options
- [ ] Add offset/limit logic to coordinator service
- [ ] Return `PaginationMetadata` in response
- [ ] Add unit tests for paginated responses

**Files Affected**:
- `weft/src/api/routes/work.ts` (edit)
- `weft/src/coordinator/index.ts` (edit)
- `weft/src/api/__tests__/work.test.ts` (edit)

**Done When**:
- ‚úÖ Same pagination behavior as agents endpoint
- ‚úÖ Works with `status` and `boundary` filters
- ‚úÖ Filter consistency validated with cursor
- ‚úÖ Tests pass

---

### Phase 2.3: Add Pagination to /api/targets Endpoint üìä

**Status**: ‚ö™ Not Started
**Effort**: M (2-3 hours)
**Depends On**: Phase 1.1, 1.2, 1.4

**Tasks**:
- [ ] Import pagination utilities in `targets.ts`
- [ ] Parse `cursor` and `limit` query params
- [ ] Update `service.listTargets()` to accept pagination options
- [ ] Add offset/limit logic to target registry
- [ ] Return `PaginationMetadata` in response
- [ ] Add unit tests for paginated responses

**Files Affected**:
- `weft/src/api/routes/targets.ts` (edit)
- `weft/src/targets/index.ts` (edit)
- `weft/src/api/__tests__/targets.test.ts` (edit)

**Done When**:
- ‚úÖ Same pagination behavior as other endpoints
- ‚úÖ Works with all target filters
- ‚úÖ Tests pass

---

### Phase 2.4: Add Semantic Context to Work Items üîç

**Status**: ‚ö™ Not Started
**Effort**: M (2 hours)
**Depends On**: Phase 1.3

**Tasks**:
- [ ] Update `GET /api/work/:id` to resolve `assignedToAgent`
- [ ] Update `GET /api/work` (list) to resolve agents for all items
- [ ] Add `resolveAgentSummary(guid)` helper in coordinator
- [ ] Maintain `assignedTo` field for backward compatibility
- [ ] Add tests verifying resolved agent details

**Files Affected**:
- `weft/src/api/routes/work.ts` (edit)
- `weft/src/coordinator/index.ts` (edit - add resolver)
- `weft/src/api/__tests__/work.test.ts` (edit)

**Done When**:
- ‚úÖ Work items include `assignedToAgent` object when assigned
- ‚úÖ Original `assignedTo` GUID still present
- ‚úÖ Handles missing/offline agents gracefully
- ‚úÖ Tests verify resolved data structure

**Response Example**:
```json
{
  "taskId": "abc-123",
  "assignedTo": "550e8400-...",
  "assignedToAgent": {
    "guid": "550e8400-...",
    "handle": "dev-agent-1",
    "agentType": "claude-code",
    "hostname": "laptop.local"
  },
  "status": "in-progress"
}
```

---

### Phase 2.5: Add Semantic Context to Targets üîç

**Status**: ‚ö™ Not Started
**Effort**: M (2 hours)
**Depends On**: Phase 1.3

**Tasks**:
- [ ] Update `GET /api/targets/:id` to include `lastSpinUp.agent`
- [ ] Update `GET /api/targets` (list) to include spin-up details
- [ ] Track last spin-up in target registry
- [ ] Add tests verifying spin-up context

**Files Affected**:
- `weft/src/api/routes/targets.ts` (edit)
- `weft/src/targets/index.ts` (edit - track spin-up history)
- `weft/src/api/__tests__/targets.test.ts` (edit)

**Done When**:
- ‚úÖ Targets include `lastSpinUp` object with agent details
- ‚úÖ Includes timestamp, outcome, work item ID
- ‚úÖ Tests verify data structure

**Response Example**:
```json
{
  "id": "ssh-server",
  "status": "in-use",
  "lastSpinUp": {
    "time": "2025-12-22T19:00:00Z",
    "agent": {
      "guid": "xyz...",
      "handle": "dev-agent-2",
      "agentType": "claude-code"
    },
    "workItemId": "abc...",
    "outcome": "success"
  }
}
```

---

### Phase 2.6: Implement Batch Operation Endpoints ‚öôÔ∏è

**Status**: ‚ö™ Not Started
**Effort**: M (3-4 hours)
**Depends On**: Phase 1.5

**Tasks**:
- [ ] Add `POST /api/agents/shutdown-batch` endpoint
- [ ] Add `POST /api/targets/disable-batch` endpoint
- [ ] Add `POST /api/work/cancel-batch` endpoint
- [ ] Implement filter-based selection logic
- [ ] Return detailed success/failure results
- [ ] Add comprehensive tests for batch operations
- [ ] Test error handling (partial failures)

**Files Affected**:
- `weft/src/api/routes/agents.ts` (edit)
- `weft/src/api/routes/targets.ts` (edit)
- `weft/src/api/routes/work.ts` (edit)
- `weft/src/coordinator/index.ts` (edit - add batch methods)
- `weft/src/api/__tests__/agents.test.ts` (edit)
- `weft/src/api/__tests__/targets.test.ts` (edit)
- `weft/src/api/__tests__/work.test.ts` (edit)

**Done When**:
- ‚úÖ All 3 batch endpoints operational
- ‚úÖ Filter-based selection works (e.g., status, idle time)
- ‚úÖ GUID-based selection works
- ‚úÖ Partial failure handling (some succeed, some fail)
- ‚úÖ Detailed error reporting per item
- ‚úÖ Tests cover success and failure scenarios

**Endpoint Examples**:
```typescript
// POST /api/agents/shutdown-batch
{
  "filter": { "status": "idle", "idleTimeMs": 300000 },
  "graceful": true
}

// Response
{
  "success": ["guid1", "guid2"],
  "failed": ["guid3"],
  "count": 2,
  "errors": {
    "guid3": "Agent currently processing work"
  }
}
```

---

### Phase 3.1: Create OpenAPI 3.0 Specification üìö

**Status**: ‚ö™ Not Started
**Effort**: M (4-6 hours)
**Depends On**: All Batch 2 phases

**Tasks**:
- [ ] Install OpenAPI tooling (`@apidevtools/swagger-cli`)
- [ ] Create `weft/openapi.yaml` with full API spec
- [ ] Document all 15+ endpoints with schemas
- [ ] Add request/response examples for each endpoint
- [ ] Document query parameters, headers, status codes
- [ ] Define reusable schemas in `components/schemas`
- [ ] Validate spec with `swagger-cli validate`

**Files Affected**:
- `weft/openapi.yaml` (new)
- `weft/package.json` (add dependencies)
- `weft/scripts/validate-openapi.sh` (new)

**Done When**:
- ‚úÖ Complete OpenAPI 3.0 spec covering all endpoints
- ‚úÖ All request/response schemas defined
- ‚úÖ Examples for common operations
- ‚úÖ Spec validates with no errors
- ‚úÖ Includes pagination, semantic context, batch operations

**Schema Structure**:
```yaml
openapi: 3.0.0
info:
  title: Weft API
  version: 0.2.0
  description: Coordinator service for Loominal multi-agent infrastructure

components:
  schemas:
    Agent:
      type: object
      required: [guid, agentType, status]
      properties:
        guid: { type: string, format: uuid }
        handle: { type: string }
        agentType: { type: string, enum: [claude-code, copilot-cli] }
        # ...

    PaginationMetadata:
      type: object
      properties:
        count: { type: integer }
        total: { type: integer }
        hasMore: { type: boolean }
        nextCursor: { type: string, nullable: true }
        prevCursor: { type: string, nullable: true }

paths:
  /api/agents:
    get:
      summary: List agents
      parameters:
        - name: cursor
          in: query
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, default: 50, maximum: 100 }
        # ...
```

---

### Phase 3.2: Add Swagger UI Endpoint (/api/docs) üåê

**Status**: ‚ö™ Not Started
**Effort**: S (1-2 hours)
**Depends On**: Phase 3.1

**Tasks**:
- [ ] Install `swagger-ui-express` package
- [ ] Add `/api/docs` route serving Swagger UI
- [ ] Add `/api/openapi.json` route serving spec
- [ ] Configure Swagger UI with branding
- [ ] Test interactive API explorer
- [ ] Add documentation link to health endpoint

**Files Affected**:
- `weft/package.json` (add dependency)
- `weft/src/api/index.ts` (add routes)
- `weft/src/api/routes/docs.ts` (new)

**Done When**:
- ‚úÖ `GET /api/docs` displays interactive Swagger UI
- ‚úÖ `GET /api/openapi.json` returns spec
- ‚úÖ All endpoints testable via UI
- ‚úÖ Examples populate correctly

**Implementation**:
```typescript
import swaggerUi from 'swagger-ui-express';
import { readFileSync } from 'fs';
import yaml from 'js-yaml';

const spec = yaml.load(readFileSync('./openapi.yaml', 'utf8'));

router.use('/api/docs', swaggerUi.serve);
router.get('/api/docs', swaggerUi.setup(spec));
router.get('/api/openapi.json', (req, res) => res.json(spec));
```

---

### Phase 3.3: Add Runtime OpenAPI Validation ‚úÖ

**Status**: ‚ö™ Not Started
**Effort**: M (2-3 hours)
**Depends On**: Phase 3.1

**Tasks**:
- [ ] Install `express-openapi-validator`
- [ ] Add validation middleware to Express app
- [ ] Configure validator to use `openapi.yaml`
- [ ] Add error handler for validation failures
- [ ] Test request validation (400 errors)
- [ ] Test response validation (catches bugs)

**Files Affected**:
- `weft/package.json` (add dependency)
- `weft/src/api/server.ts` (add middleware)
- `weft/src/api/middleware/openapi.ts` (new)

**Done When**:
- ‚úÖ Invalid requests rejected with 400 + helpful errors
- ‚úÖ Response validation catches schema violations
- ‚úÖ Doesn't break existing valid requests
- ‚úÖ Validation errors include field names and reasons

**Implementation**:
```typescript
import * as OpenApiValidator from 'express-openapi-validator';

app.use(
  OpenApiValidator.middleware({
    apiSpec: './openapi.yaml',
    validateRequests: true,
    validateResponses: true,
  })
);
```

---

## Critical Path Analysis

**Longest Dependency Chain** (gates final completion):

```
Batch 1 (Foundation) ‚Üí Batch 2 (Core) ‚Üí Batch 3 (Docs)
   3 hours          ‚Üí    4 hours     ‚Üí    8 hours

Total Critical Path: ~15 hours
```

**Without Parallelization**: 30+ hours
**With Parallelization**: 15-16 hours (50% reduction)

**Key Bottlenecks**:
- Phase 3.1 (OpenAPI spec) - Must be sequential, blocks 3.2 and 3.3
- Batch 1 must complete before Batch 2 can start

---

## Testing Strategy

### Unit Tests (Per Phase)
- Each phase adds 5-10 unit tests
- Target: +40 new tests (127 ‚Üí 167 total)
- Coverage: Maintain >80% line coverage

### Integration Tests (Batch 3)
- Test pagination across all endpoints
- Test semantic context resolution
- Test batch operations with partial failures
- Test OpenAPI validation

### Test Scenarios
```typescript
describe('Pagination', () => {
  it('returns first page without cursor');
  it('returns next page with cursor');
  it('validates cursor filter consistency');
  it('enforces max limit of 100');
  it('handles empty result sets');
});

describe('Semantic Context', () => {
  it('resolves agent details for work items');
  it('handles missing agents gracefully');
  it('includes agent summary in responses');
});

describe('Batch Operations', () => {
  it('shuts down multiple agents');
  it('reports partial failures');
  it('validates filter criteria');
});
```

---

## Parallelization Strategy

### Batch 1: 5 Agents in Parallel
- **Agent 1**: Phase 1.1 (Pagination utilities)
- **Agent 2**: Phase 1.2 (Pagination types)
- **Agent 3**: Phase 1.3 (Semantic context types)
- **Agent 4**: Phase 1.4 (Parameter naming)
- **Agent 5**: Phase 1.5 (Batch operation types)

**Coordination**: All share `@loominal/shared` package - coordinate via git branches

---

### Batch 2: 6 Agents in Parallel
- **Agent 1**: Phase 2.1 (Agents pagination)
- **Agent 2**: Phase 2.2 (Work pagination)
- **Agent 3**: Phase 2.3 (Targets pagination)
- **Agent 4**: Phase 2.4 (Work semantic context)
- **Agent 5**: Phase 2.5 (Target semantic context)
- **Agent 6**: Phase 2.6 (Batch operations)

**Coordination**: Each agent owns different route files - minimal conflicts

---

### Batch 3: Sequential Start, Then Parallel
1. **Phase 3.1** (OpenAPI spec) - MUST complete first
2. **Phase 3.2 + 3.3** (Swagger UI + Validation) - Parallel after 3.1

---

## Risk Assessment & Mitigation

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| **Pagination breaks filters** | High | Medium | Copy proven Warp pattern exactly |
| **Type conflicts in shared** | Medium | Low | Use feature branches, merge carefully |
| **OpenAPI spec incomplete** | Medium | Medium | Generate from code + manual review |
| **Tests fail after merge** | High | Low | Run full suite after each phase |
| **Performance regression** | Medium | Low | Benchmark list endpoints before/after |

---

## Success Criteria

### Functional Requirements
- ‚úÖ All list endpoints support pagination (`/api/agents`, `/api/work`, `/api/targets`)
- ‚úÖ Pagination is backward compatible (no cursor = first page)
- ‚úÖ Work items include resolved agent details
- ‚úÖ Targets include last spin-up context
- ‚úÖ Batch operations work for agents, targets, work
- ‚úÖ Both `boundary` and `classification` parameters accepted

### Documentation Requirements
- ‚úÖ Complete OpenAPI 3.0 spec
- ‚úÖ Swagger UI accessible at `/api/docs`
- ‚úÖ All endpoints documented with examples

### Quality Requirements
- ‚úÖ All 127 existing tests still pass
- ‚úÖ +40 new tests added
- ‚úÖ No breaking changes
- ‚úÖ Build passes (`pnpm build`)
- ‚úÖ Lint passes (`pnpm lint`)
- ‚úÖ Type check passes (`pnpm typecheck`)

### Performance Requirements
- ‚úÖ Paginated endpoints respond in <100ms for 50 items
- ‚úÖ Batch operations handle 100+ items in <1s
- ‚úÖ OpenAPI validation adds <10ms overhead

---

## Release Checklist

### Pre-Release
- [ ] All phases completed and merged
- [ ] Full test suite passes (167+ tests)
- [ ] OpenAPI spec validates
- [ ] Manual testing of all new features
- [ ] Update CHANGELOG.md with v0.2.0 changes
- [ ] Update README.md with pagination examples

### Release
- [ ] Bump version to 0.2.0 in `package.json`
- [ ] Create git tag `v0.2.0`
- [ ] Build and publish npm package
- [ ] Deploy to staging environment
- [ ] Smoke test in staging
- [ ] Deploy to production

### Post-Release
- [ ] Monitor error rates
- [ ] Check API performance metrics
- [ ] Gather agent feedback on usability
- [ ] Plan v0.3.0 features (WebSocket, caching)

---

## Stakeholders

| Stakeholder | Role | Involvement |
|-------------|------|-------------|
| **Michael LoPresti** | Lead Developer | Overall architecture, final review |
| **AI Agents** | Primary Users | Test pagination and semantic context |
| **Warp Integration** | Dependency | Reference implementation for pagination |

---

## Suggested First Action

**Kick off Batch 1** with the following delegation to 5 parallel agents:

```
Agent 1: Implement Phase 1.1 (Pagination utilities)
Agent 2: Implement Phase 1.2 (Pagination types)
Agent 3: Implement Phase 1.3 (Semantic context types)
Agent 4: Implement Phase 1.4 (Parameter naming)
Agent 5: Implement Phase 1.5 (Batch operation types)
```

**Estimated Completion**: 2-3 hours (vs 6-8 sequential)

After Batch 1 completes, proceed to Batch 2 with 6 agents in parallel.

---

## Appendix: Anthropic Compliance Scorecard

| Principle | Before (v0.1.9) | After (v0.2.0) | Improvement |
|-----------|-----------------|----------------|-------------|
| **1. Choose Thoughtfully** | 18/20 (A-) | 20/20 (A+) | +2 (Batch ops) |
| **2. Namespace Clearly** | 20/20 (A+) | 20/20 (A+) | - |
| **3. Return Meaningful Context** | 15/20 (B) | 19/20 (A) | +4 (Semantic context) |
| **4. Optimize Token Usage** | 14/20 (C+) | 20/20 (A+) | +6 (Pagination) |
| **5. Engineer Descriptions** | 16/20 (B+) | 19/20 (A) | +3 (OpenAPI docs) |
| **TOTAL** | **83/100 (B+)** | **98/100 (A+)** | **+15** |

---

**Plan Complete**: Ready for agent assignment and parallel execution.
